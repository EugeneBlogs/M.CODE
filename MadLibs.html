<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <title>Генератор смешных историй</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&family=Roboto+Slab:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        /* База */
        :root {
            --primary-color: #6c5ce7;
            --primary-hover-color: #5649c0;
            --secondary-color: #a29bfe;
            --accent-color: #6877ff;
            --accent-hover-color: #435fe8;
            --text-color: #2d3436;
            --light-color: #f5f6fa;
            --error-color: #d63031;
        }

        body {
            font-family: "Montserrat", sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--light-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Кнопка "Назад" */
        .back-btn {
            display: inline-block;
            margin-bottom: 20px;
            padding: 10px 20px;
            background-color: var(--secondary-color);
            color: white;
            text-decoration: none;
            border-radius: 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background-color: var(--primary-color);
            transform: translateY(-2px);
        }

        /* Кнопка "Избранное" */
        .favorite-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            margin-left: 10px;
        }

        .favorite-btn:hover {
            background-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .favorite-btn.active {
            background-color: var(--error-color);
        }

        .favorite-btn.active {
            background-color: var(--error-color);
            transform: scale(1.1);
        }

        .favorite-btn.active:hover {
            background-color: #c0392b;
        }

        /* Анимации для сердца */
        @keyframes heartbeat {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }

            25% {
                transform: translate(-50%, -50%) scale(1.3);
                opacity: 0.8;
            }

            50% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }

            75% {
                transform: translate(-50%, -50%) scale(1.3);
                opacity: 0.8;
            }

            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        @keyframes heartbreak {
            0% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
                opacity: 1;
            }

            50% {
                transform: translate(-50%, -50%) scale(1.1) rotate(0deg);
                opacity: 0.8;
            }

            100% {
                transform: translate(-50%, -50%) scale(0.5) rotate(45deg);
                opacity: 0;
                filter: drop-shadow(0 0 10px rgba(255, 0, 0, 0.7));
            }
        }

        .heart-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 100px;
            z-index: 9999;
            pointer-events: none;
            text-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
        }

        .heartbeat {
            animation: heartbeat 1s ease-out;
        }

        .heartbreak {
            animation: heartbreak 0.8s ease-out forwards;
        }

        /* Основная часть */
        .card {
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        h1 {
            font-family: "Roboto Slab", serif;
            color: var(--primary-color);
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .info {
            font-size: 1.1rem;
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 10px;
            background-color: rgba(108, 92, 231, 0.1);
            border-left: 5px solid var(--primary-color);
        }

        .combo-container {
            margin: 30px 0;
        }

        select {
            font-family: "Montserrat", sans-serif;
            font-size: 1rem;
            padding: 15px;
            width: 100%;
            border-radius: 10px;
            border: 2px solid var(--secondary-color);
            background-color: white;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 1em;
        }

        .btn {
            font-family: "Montserrat", sans-serif;
            font-size: 1rem;
            font-weight: 600;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-hover-color);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(108, 92, 231, 0.4);
        }

        .btn-accent {
            background-color: var(--accent-color);
            color: white;
        }

        .btn-accent:hover {
            background-color: var(--accent-hover-color);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(253, 121, 168, 0.4);
        }

        .btn-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
        }

        .form-container {
            margin: 30px 0;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 25px;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 1.1rem;
            color: var(--primary-color);
        }

        .form-group input {
            font-family: "Montserrat", sans-serif;
            font-size: 1rem;
            padding: 15px;
            border: 2px solid #dfe6e9;
            border-radius: 10px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .story-title {
            font-family: "Roboto Slab", serif;
            color: var(--primary-color);
            text-align: center;
            font-size: 2rem;
            margin: 30px 0;
        }

        .story-text {
            font-size: 1.1rem;
            line-height: 1.8;
            margin: 30px 0;
            padding: 30px;
            border-radius: 10px;
            background-color: rgba(108, 92, 231, 0.05);
            white-space: pre-line;
        }

        .user-word {
            color: #6c5ce7;
            font-weight: bold;
            background-color: rgba(108, 92, 231, 0.1);
            padding: 2px 4px;
            border-radius: 4px;
        }

        .scroll-container {
            max-height: 500px;
            overflow-y: auto;
            padding: 10px;
            margin-bottom: 30px;
        }

        .footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: #636e72;
            font-size: 0.9rem;
        }

        .footer a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Прогресс-бар */
        .progress-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 10px;
            margin: 20px 0;
            height: 20px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .progress-text {
            color: var(--text-color);
            margin-top: 5px;
            text-align: center;
            font-size: 0.9rem;
            padding: 5px;
            background-color: rgba(108, 92, 231, 0.1);
            border-radius: 8px;
        }

        .dark-theme .progress-text {
            background-color: rgba(108, 92, 231, 0.2);
            color: #f5f6fa;
        }


        /* Связь с нами */
        .contact-block {
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.1rem;
        }

        .contact-block a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
        }

        .contact-block a:hover {
            text-decoration: underline;
        }

        /* Темная тема */
        body.dark-theme {
            background-color: #1a1a1a;
            color: #f5f6fa;
        }

        .dark-theme .card {
            background-color: #2d3436;
            color: #f5f6fa;
        }

        .dark-theme .info {
            background-color: rgba(108, 92, 231, 0.2);
            color: #f5f6fa;
        }

        .dark-theme .form-group input {
            background-color: #3d4548;
            color: #f5f6fa;
            border-color: #6c5ce7;
        }

        .dark-theme .story-text {
            background-color: rgba(108, 92, 231, 0.1);
            color: #f5f6fa;
        }

        .dark-theme .progress-container {
            background-color: #3d4548;
        }

        /* Иконки для кнопок */
        .btn i {
            margin-right: 8px;
        }

        /* Блок с количеством историй */
        .stories-count {
            text-align: center;
            margin: 20px 0;
            font-size: 1.1rem;
        }

        .stories-count span {
            color: var(--primary-color);
            font-weight: bold;
            font-size: 1.3rem;
        }

        /* Таблица */
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }

        #stories-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.9em;
            min-width: 600px;
        }

        #stories-table thead tr {
            background-color: var(--primary-color);
            color: white;
            text-align: left;
        }

        #stories-table th,
        #stories-table td {
            padding: 12px 15px;
            border: 1px solid #ddd;
        }

        #stories-table tbody tr {
            border-bottom: 1px solid #dddddd;
        }

        #stories-table tbody tr:nth-of-type(even) {
            background-color: rgba(108, 92, 231, 0.05);
        }

        #stories-table tbody tr:last-of-type {
            border-bottom: 2px solid var(--primary-color);
        }

        #stories-table tbody tr:hover {
            background-color: rgba(108, 92, 231, 0.1);
        }

        .dark-theme #stories-table th,
        .dark-theme #stories-table td {
            border-color: #444;
        }

        .dark-theme #stories-table tbody tr {
            border-bottom-color: #444;
        }

        .dark-theme #stories-table tbody tr:nth-of-type(even) {
            background-color: rgba(108, 92, 231, 0.1);
        }

        /* Переключатель темы */
        .theme-switch {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }

        /* Анимация перехода между темами */
        body {
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        .card {
            transition: background-color 0.5s ease, box-shadow 0.5s ease;
        }

        .info,
        .story-text,
        .form-group input,
        #stories-table {
            transition: background-color 0.5s ease, border-color 0.5s ease;
        }

        /* Плавное переключение иконки темы */
        .theme-icon {
            transition: transform 0.3s ease;
        }

        .theme-icon:hover {
            transform: rotate(30deg) scale(1.1);
        }

        /* Модальные окна */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .modal-title {
            font-family: "Roboto Slab", serif;
            color: var(--primary-color);
            margin-top: 0;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #636e72;
            background: none;
            border: none;
        }

        .modal-close:hover {
            color: var(--error-color);
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 20px;
        }

        /* Анимации */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
    </style>
</head>

<body>
    <div class="theme-switch" id="theme-toggle">
        <i class="theme-icon">🌓</i>
    </div>
    <div class="container">
        <a href="index.html" class="back-btn">← Назад</a>

        <div class="card">
            <h1>Генератор смешных историй</h1>

            <div class="stories-count">
                На нашем сайте <span id="stories-count">0</span> историй.
            </div>

            <div class="info">
                Приготовьтесь к веселью - будет очень смешно!😂<br><br>
                Выберите название истории из предложенного списка, затем ответьте на вопросы.
                Ответом может служить как одно слово, так и словосочетания.<br><br>
                Данные ответы будут подставлены в текст.<br>
                Так как вы не знали контекст, получится смешная история😁
            </div>

            <div class="combo-container">
                <select id="story-select">
                    <!-- Варианты будут заполнены JavaScript -->
                </select>
            </div>

            <div class="btn-container">
                <button class="btn btn-primary" id="start-btn">Сочинить историю</button>
                <button class="favorite-btn" id="favorite-btn">❤️</button>
            </div>
        </div>

        <div class="card" id="form-section" style="display: none">
            <h2 class="story-title" id="current-title"></h2>
            <div id="progress-container-inner"></div>
            <div class="scroll-container" id="form-container">
                <!-- Поля формы будут заполнены JavaScript -->
            </div>
            <button class="btn btn-accent" id="result-btn">Показать результат</button>
        </div>

        <div class="card" id="result-section" style="display: none">
            <h2 class="story-title" id="result-title"></h2>
            <div class="story-text" id="result-text"></div>
            <div class="btn-container">
                <button class="btn btn-primary" id="home-btn">Выбрать другую историю</button>
            </div>
        </div>

        <div class="card">
            <h2>Все истории</h2>

            <div class="table-container">
                <table id="stories-table">
                    <thead>
                        <tr>
                            <th>Название истории</th>
                            <th>Количество пропусков</th>
                            <th>Описание сюжета</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Данные будут заполнены JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card contact-block">
            <p>Если у вас есть идея для новой истории, или вы заметили ошибку в нашей, то вы можете связаться с нами по
                почте: <a href="mailto:mylnikcode@yandex.ru">mylnikcode@yandex.ru</a>.</p>
        </div>

        <div class="footer">
            Идея: MylnikCode.<br>Разработка сайта и генерация историй: DeepSeek.
        </div>
    </div>

    <!-- Модальное окно для сообщений -->
    <div class="modal" id="message-modal">
        <div class="modal-content fade-in">
            <button class="modal-close" id="modal-close">&times</button>
            <h3 class="modal-title" id="modal-title">Сообщение</h3>
            <p id="modal-message"></p>
            <div class="modal-buttons">
                <button class="btn btn-primary" id="modal-confirm">OK</button>
            </div>
        </div>
    </div>

    <script>
        // Информация об историях
        // Названия
        const titles = [
            "Отпуск мечты", "Вот так музей!", "Больничка", "Однажды на уроке", "Испуг требует жертв",
            "Случай в мастерской", "(Не)профессиональный ремонт", "Письмо Деду Морозу", "Потерянная вещь",
            "Поездочка в купе", "Всё началось в супермаркете", "Как в сказке", "ЗаГАВчительная история",
            "Это повод устроить вечеринку!", "64-битная история", "ДТП", "Квест", "Отель №666", "На работу!",
            "Я не в себе", "День, когда всё пошло не так", "Дело о загадочной посылке", "Бабушка на «БМВ»",
            "#НикомуНеГовори", "10 способов потратить зарплату за один день", "Кот, который правил миром",
            "Виртуальный конфликт", "Кто украл торт?", "Диета, или как я худел", "Конец света?",
            "По вашему запросу ничего не найдено... (СКОРО)", "On Air (В эфире) (СКОРО)",
            "Бизнес-темка (СКОРО)", "Концерт (СКОРО)", "Короче, план такой! (СКОРО)",
            "Маньяк из дома напротив (СКОРО)", "олакреЗ (СКОРО)", "Среди людей... (СКОРО)",
            "Многоэтажка (СКОРО)", "Улётная (СКОРО)",
        ]
        // Описания сюжетов
        const plots = [
            "История о незабываемом летнем отпуске с неожиданными поворотами",
            "Забавный поход в музей, который запомниться надолго",
            "Визит к врачу оборачивается внезапмными открытиями",
            "Смешной и нелепый случай на школьном уроке",
            "Просмотр фильма ужасов и его последствия",
            "Необычный визит в ремонтную мастерскую",
            "История о семейном ремонте, который пошёл не по плану",
            "Трогательное письмо Деду Морозу с милыми просьбами",
            "История о потерянной вещи и её поисках",
            "Незабываемое путешествие в купейном вагоне поезда",
            "Смешное приключение в супермаркете, которое держит в напряжении",
            "Современная интерпретация известной сказки",
            "Трогательная история о спасении щенка во время прогулки",
            "Безумная домашняя вечеринка с участием неожиданных гостей",
            "Ностальгическая история о компьютерном клубе 90-х",
            "Драматическая история о дорожном происшествии",
            "Корпоративный квест с непредсказуемыми поворотами и заданиями",
            "Мистическая история о загадочном отеле с тёмными секретами",
            "Смешной рассказ о самом неудачном рабочем дне",
            "Фантастическая история о спонтанной перемене тел",
            "День, когда всё пошло не так с самого утра",
            "Детективная история о загадочной посылке и старом деле",
            "Забавная история о бабушке, которая обожает скорость",
            "Триллер о таинственном телефоне с угрожающими сообщениями",
            "Сатирический гид по быстрой трате денег",
            "Фантастическая история о коте, который правит миром",
            "Поучительная история о виртуальном конфликте и его разрешении",
            "Детективная история о пропавшем торте",
            "История о диете, мучениях и её последствиях",
            "На мир надвигается глобальная катастрофа. История о переживаниях людей"
        ]

        // Функция для заполнения таблицы
        function fillStoriesTable() {
            const tableBody = document.querySelector("#stories-table tbody")
            const favorites = getFavorites()

            // Сначала добавляем избранные истории
            titles.forEach((title, index) => {
                if (favorites.includes(title)) {
                    const row = createTableRow(title, index, true)
                    tableBody.appendChild(row)
                }
            })

            // Затем добавляем остальные истории
            titles.forEach((title, index) => {
                if (!favorites.includes(title)) {
                    const row = createTableRow(title, index, false)
                    tableBody.appendChild(row)
                }
            })
        }

        // Вспомогательная функция для создания строки таблицы
        function createTableRow(title, index, isFavorite) {
            const row = document.createElement("tr")

            // Название истории
            const titleCell = document.createElement("td")
            titleCell.textContent = isFavorite ? `❤️${title}❤️` : title
            row.appendChild(titleCell)

            // Количество пропусков
            const blanksCell = document.createElement("td")
            blanksCell.textContent = stories[index] ? stories[index].length : 0
            row.appendChild(blanksCell)

            // Описание сюжета
            const plotCell = document.createElement("td")
            plotCell.textContent = plots[index] || "Описание отсутствует"
            row.appendChild(plotCell)

            return row
        }

        // Вызываем функцию заполнения таблицы при загрузке страницы
        document.addEventListener("DOMContentLoaded", fillStoriesTable)

        const stories = [
            [
                "Мужское имя", "Куда?", "Кем? Чем? (мужской род)", "Кем? Чем? (мужской род)", "Каким?", "Каким?",
                "Кого? Что?", "Кого? Что?", "Кого? Чего? (множественное число)", "Где?", "Что делая?", "Что делая?",
                "Что делал?", "Что делая?", "Что сделать?", "Что? (средний род)", "Кем? Чем?", "Кем? Чем?",
                "Кого? Чего? (множественное число)"
            ],
            [
                "Женское имя", "Кого? Чего?", "Кого? Что?", "Кого? Что?", "Кого? Что? (мужской род)", "Кем?",
                "Что сделали?", "Кто? Что?", "Кем? Чем?", "Возглас (междометие)", "Какая?", "Каком?", "Кого? Что?",
                "Кого? Что?", "Какая?", "Какая?"
            ],
            [
                "Мужское имя", "Кем? Чем?", "Что сделать?", "Куда?", "Фамилия женщины",
                "Прямая речь в повелительном наклонении", "Кого? Чего? (мужской род)", "Орган человека (родительный падеж)",
                "Что сделать?", "Где?", "Кого? Чего?", "Какой?"
            ],
            [
                "Число", "Школьный урок (дательный падеж)", "Женское имя и отчество", "Кто? Что?", "Что делать?",
                "Имя мальчика", "Прямая речь с вопросом", "Кого? Что? (множественное число)", "Возглас", "Что делать?",
                "Имя мальчика (дательный падеж)", "Прямая речь с вопросом", "Что делай?", "Любая прямая речь",
                "Оценка (от 2 до 5)", "Кого? Что?"
            ],
            [
                "Какой?", "Что? (мужской род)", "Кого?", "Мужское имя и фамилия", "Какие?", "Что? (множественное число)",
                "Что сделать?", "Кто?", "Что сделал?", "Что сделали?", "Что сделали?", "Как?", "Кого?",
                "Женское имя и фамилия"
            ],
            [
                "Мужское имя", "Что?", "Каким?", "Какой?", "Мужское имя", "Какой?", "Что делать?", "Число",
                "Кого? Что?", "Кого? Что?", "Что делал?", "Радостный возглас", "Число", "Что? (винительный падеж)",
                "Куда?", "Какой?", "Что делать?"
            ],
            [
                "Фамилия семьи", "Кого? (мужской род)", "Какого?", "Что?", "Кого? Чего?", "Кого? Чего?", "Откуда?",
                "Куда?", "Что делать?", "Что сделать?", "Что сделала?", "Как?", "Как?", "Какую?", "Что делать?"
            ],
            [
                "Какой?", "Где?", "Кто? Что?", "О ком? О чём? (без предлога)", "Каким?", "Что сделал?", "Каким?",
                "Что делать?", "Кем? Чем? (множественное число)", "Что делать?", "Кто?", "Число"
            ],
            [
                "Женское имя", "Где?", "Куда?", "Что сделать?", "Кого? Что?", "Какой?", "Кого? Что?", "Что сделала?",
                "Куда?", "Кого? (мужской род)", "Кого? Чего?", "Кто? (женский род)", "Где?", "Кого? Что?", "Что делала?"
            ],
            [
                "Мужское имя", "Город (родительный падеж)", "Город (родительный падеж)", "Кого? Что?",
                "Кем? Чем? (множественное число)", "Кто?", "Кем? Чем? (мужской род)", "Что сделаю?", "Кого? Что?",
                "Кого? Что?", "Кто? Что? (мужской род)", "Что сделал?", "Мужское имя (творительный падеж)", "Какой?",
                "Кто? Что? (мужской род)", "Какую?", "Кого? Что? (женский род)", "Возглас", "Кто? Что?", "Что делать?"
            ],
            [
                "Какой?", "Кто? Что? (мужской род)", "Каком?", "Какой?", "Кто? Что? (мужской род)", "Кто? (женский род)",
                "Кем? Чем?", "Какую?", "Кого? Что? (мужской род)", "Радостный возглас", "Какой?",
                "Кто? Что? (мужской род)", "Крик", "Прямая речь с вопросом", "Что делаем?", "Куда?"
            ],
            [
                "Кто? Что? (мужской род)", "Какой?", "Какая?", "Кто? Что? (женский род)", "Кто? Что? (мужской род)",
                "Какой?", "Кого? Что?", "Что делает?", "Кого? Что?", "Что делает?", "Кто? Что?", "Что делает?",
                "Кто? Что? (единственное число)", "Где?", "Кого? Чего? (множественное число)", "Кто? Что?",
                "Что делает?", "Какой?", "Кто? Что? (мужской род)", "Кем? (2 слова)", "Кто? (мужской род)",
                "Кем? Чем?", "Кого? Что?"
            ],
            [
                "Какое?", "Куда?", "Кличка собаки (кабель)", "Каким?", "Каким?", "Каким?", "Какой?", "Где?",
                "Орган собаки (винительный падеж)", "Какой?", "Что сделал?", "Любая прямая речь",
                "Кого? Что? (винительный падеж)", "Куда?", "Где?", "Какая? (родительный падеж)", "Что делала?",
                "Что делал?", "Число", "Кого? Что?"
            ],
            [
                "Мужское имя", "Кем? Чем? (множественное число)", "Кем? Чем? (женский род)", "Кем? Чем? (женский род)",
                "Кто? Что? (мужской род)", "Кто? Что? (женский род)", "Женское имя", "Кого? (мужской род)",
                "Кто? Что? (мужской род)", "Кто? Что? (мужской род)", "Прямая речь в повелительном наклонении",
                "Жидкость (творительный падеж)", "Название песни", "Мужское имя", "Кого? Что?", "Где?", "Где?"
            ],
            [
                "В каком?", "В ком? В чём? (мужской род)", "Число", "Какой?", "Кто? Что? (мужской род)", "Кто?",
                "Название игры", "Название игры", "Мужское имя", "Что делать?", "Какой?", "Какой?", "Кто? Что?",
                "Какой?", "Мужское имя", "Что делать? Что сделать?", "Каких?", "Кого? Чего? (множетсвенное число)",
                "Выкрик"
            ],
            [
                "Какой?", "Какой?", "Мужское имя", "Куда?", "Кого? Чего?", "Какая? (родительный падеж)", "Кого? Что?", "Каким?",
                "Кем? Чем? (мужской род)", "Как?", "Кого? Что?", "Кого? Что?", "Какой?", "Что сделали?", "Что делало?",
                "Кто? (женский род)", "Кого?", "Что делая?", "Как?", "Какой?"
            ],
            [
                "Время", "Женское имя", "Мужское имя", "Мужское имя", "Что сделал?", "Кто? Что? (мужской род)", "Что сделали?",
                "Где?", "Что сделаете?", "Что сделать?", "Где?", "Кого? Чего?", "Что делаете?", "Куда?", "Куда?", "В ком? В чём? (без предлога)",
                "Кого? Чего?", "Кем? Чем?", "Кем? Чем?", "Число", "Кто? (мужской род)", "Кем? Чем?", "Кто? (множественное число)",
                "Какие?", "Какие?", "Как?", "Где?"
            ],
            [
                "Куда?", "Каким?", "Мужское имя", "Каком?", "Что сделала?", "Какой?", "Кто? (мужской род)", "Какая? (родительный падеж)",
                "Что сделал?", "Что делал?", "Что делал?", "Кем? Чем?", "Каким?", "Кто? Что? (множественное число)", "Кого? Что?",
                "Кто? Что? (мужской род)", "Кого? Чего?", "Кто? Что? (средний род)", "Кого? Что?", "Какими?",
                "Кем? Чем? (множественное число)", "Кто?"
            ],
            [
                "Мужское имя", "Кто? Что? (мужской род)", "Кого? Что?", "Время", "Время", "Каком?", "Кого? Что?", "Откуда?", "Что сделать?",
                "Где?", "Что сделать?", "Чем?", "Каких?", "Кого? Чего? (множественное число)", "Кого? Что?", "Мужское имя", "Какой?",
                "Кого? Что?", "Кто? (мужской род)", "Обращение (мужской род)", "Кого? Что?"
            ],
            [
                "Какие?", "Кого? Что? (множественное число)", "Кого? Что?", "Обращение (мужской род)", "Кем? Чем?", "Кто? Что? (мужской род)",
                "В ком? В чём? (без предлога)", "Где?", "Что делать?", "Женское имя", "Как?", "Кого? Что?", "Как?", "Кто? Что? (множественное число)",
                "Что делать?", "Каким?", "Кого? Что?", "Что сделала?", "На ком? На чём? (без предлога)", "Какая?", "Какой?", "Что делали?"
            ],
            [
                "Мужское имя", "Жидкость (винительный падеж)", "Кого? Что? (женский род)", "Кто? Что? (мужской род)", "Кто? Что? (женский род)",
                "Откуда?", "Кого? Что? (мужской род)", "Кто? Что? (мужской род)", "Где?", "Кто? (женский род)", "Какой?", "Кто? Что? (мужской род)",
                "Что сделать?", "Кем? Чем?", "Кого? Что?", "Кто? Что? (множественное число)", "Кого? Что?", "Что сделал?"
            ],
            [
                "Кто?", "Какая?", "Мужское имя и фамилия", "Женское имя и фамилия", "Какой?", "Кем? Чем?", "Число", "Год", "Кого? Чего?",
                "Название деревни", "В ком? В чём? (множественное число) (без предлога)", "Какая? (родительный падеж)", "Кого? Что? (мужской род)",
                "Кто? Что? (множественное число)", "Кто? Что? (множественное число)", "Кто? (женский род)", "Кто? (мужской род)"
            ],
            [
                "Какая? (родительный падеж)", "Женское имя", "Какая?", "Какая?", "Кем? Чем? (множественное число)", "Каком?", "Кто? (мужской род)",
                "Какой?", "Что сделали?", "Как?", "Что делала?", "Что делала?", "Кого? Что?", "Кого? Что?", "Кто? (женский род)", "Кто? (женский род)",
                "Какая?", "Каким?", "Каким?"
            ],
            [
                "Женское имя", "Где?", "Что сделала?", "Куда?", "Что сделала?", "Кого? Что?", "Что сделала?", "Что сделала?", "Что делать?",
                "Женское имя", "Кем? Чем?", "Каким?", "Как?", "Кто? Что? (мужской род)", "Кого? Что?", "Как?"
            ],
            [
                "Куда?", "Кого? Что? (мужской род)", "Кого? Что? (женский род)", "Каких?", "Кого? Чего? (множественное число)",
                "Кого? Что?", "Кого? Что?", "Каком?", "Кого? Что?", "Словосочетание (прилагательное + существительное в винительном падеже)",
                "Словосочетание (прилагательное + существительное в винительном падеже)", "Кем? Чем? (мужской/средний род)", "Кем? Чем? (мужской/средний род)",
                "Какой?", "Кого? Чего?", "Кого? Что?", "Каким?", "Кого? Что?", "Кого? Что?", "Кем? Чем?", "Кого? Чего?", "Каким?", "Число", "Что сделаешь?",
                "Что сделаешь?", "Кому? Чему?", "Кому? Чему?", "Кого? Что?", "Кого? Что?", "Кто?", "Кого? Что?", "Кто?", "Кого? Что?", "Кто?", "Кого? Что?",
                "Место/Заведение (винительный падеж)", "Кого? Что?", "Кого? Что?", "Кого?", "Кого? Что?", "Где?", "Кого?", "Кого? Что? (множественное число)",
                "На ком? На чём? (без предлога)", "Кого? Что? (множественное число)", "Кем? Чем?", "Кем? Чем?"
            ],
            [
                "Фамилия известного человека (родительный падеж)", "Сравнительная степень прилагательного", "Кличка кота", "Что делать?",
                "Какие?", "Как?", "Кого? Чего?", "Кем? Чем?", "Кого? Чего?", "Кто? (множественное число)", "Какой?", "Какой?", "Кто? (мужской род)",
                "Как?", "Кого? Что?", "Что сделали?", "Кого? Чего?", "Что делать?"
            ],
            [
                "Какого?", "Кого? Что?", "Прилигательное (творительный падеж)", "Каким?", "Каких?", "Кем? Чем?", "Что? (винительный падеж)",
                "Кем? Чем?", "Как?", "Прямая речь с вопросом", "Кого? Чего?"
            ],
            [
                "Что?", "Женское имя", "Кем? Чем?", "Откуда?", "Женское имя", "Что делала?", "Каких?", "Какой?", "Кличка кота", "Орган кота",
                "Что сделал?", "Каким?"
            ],
            [
                "Какие?", "Число", "Что делать?", "Кем? Чем?", "Кем? Чем?", "Кем? Чем? (женский род)", "Кого? Чего?", "Кому? Чему?",
                "Кого? Чего?", "Что делал?", "Что делать?", "Что? (мужской род)", "Что делал?", "Кого? Что?", "Число", "Кого? Чего?"
            ],
            [
                "Какой?", "Кто? Что? (женский род)", "Кого? Что? (множественное число)", "Кого? Что? (множественное число)",
                "Каких?", "Кого? Что? (множественное число)", "Как?", "Что делала?", "Какая?", "Кем? Чем?", "Где?", "Орган человека (винительный падеж)",
                "Ёмкость (винительный падеж)", "Что делали?"
            ]
        ]

        // Элементы DOM
        const storySelect = document.getElementById("story-select")
        const startBtn = document.getElementById("start-btn")
        const resultBtn = document.getElementById("result-btn")
        const homeBtn = document.getElementById("home-btn")
        const formSection = document.getElementById("form-section")
        const progressSection = document.getElementById("progress-container-inner")
        const resultSection = document.getElementById("result-section")
        const formContainer = document.getElementById("form-container")
        const currentTitle = document.getElementById("current-title")
        const resultTitle = document.getElementById("result-title")
        const resultText = document.getElementById("result-text")

        // Элементы модального окна
        const messageModal = document.getElementById("message-modal")
        const modalClose = document.getElementById("modal-close")
        const modalTitle = document.getElementById("modal-title")
        const modalMessage = document.getElementById("modal-message")
        const modalConfirm = document.getElementById("modal-confirm")

        // Текущее состояние
        let currentStoryId = -1
        let currentStoryTitle = ""

        // Инициализация выпадающего списка с историями
        function initDropdown() {
            rebuildStoryDropdown()

            // Установка случайного начального значения (без "СКОРО")
            let randomTitle
            do {
                randomTitle = titles[Math.floor(Math.random() * titles.length)]
            } while (randomTitle.includes("СКОРО"))

            storySelect.value = randomTitle
            updateFavoriteButton()
        }

        // Вспомогательная функция для создания элемента option
        function createOptionElement(title, isFavorite) {
            const option = document.createElement("option")
            option.value = title
            option.textContent = isFavorite ? `❤️${title}❤️` : title
            return option
        }

        // Показать модальное окно с сообщением
        function showModal(title, message) {
            modalTitle.textContent = title
            modalMessage.textContent = message
            messageModal.style.display = "flex"
        }

        // Скрыть модальное окно
        function hideModal() {
            messageModal.style.display = "none"
        }

        function showRandomTip() {
            const tips = [
                "Используй имена друзей для большего веселья!😆",
                "Попробуй ввести что-то абсурдное!🤯",
                "Сочетай несочетаемое!🤪",
                "Отвечай естественно, что первое придёт в голову!🤩",
                "Воплоти в историях свои фактазии!😍"
            ]
            const tipElement = document.createElement("div")
            tipElement.className = "info random-tip"
            tipElement.innerHTML = `💡 Совет: ${tips[Math.floor(Math.random() * tips.length)]}`
            formContainer.appendChild(tipElement)
        }

        // Начать новую историю
        function startStory() {
            currentStoryTitle = storySelect.value

            if (currentStoryTitle.includes("СКОРО")) {
                showModal("Немного терпения...", "Эта история ещё в разработке.")
                return
            }

            currentStoryId = titles.indexOf(currentStoryTitle)

            // Показать раздел с формой
            formSection.style.display = "block"
            resultSection.style.display = "none"

            // Установить заголовок
            currentTitle.textContent = currentStoryTitle

            // Очистить предыдущие поля формы и прогресс-бар
            formContainer.innerHTML = ""
            progressSection.innerHTML = ""

            // Добавить совет
            showRandomTip()

            // Добавить прогресс-бар
            const progressContainer = document.createElement("div")
            progressContainer.className = "progress-container"

            const progressBar = document.createElement("div")
            progressBar.className = "progress-bar"
            progressBar.id = "progress-bar"

            const progressText = document.createElement("div")
            progressText.className = "progress-text"
            progressText.id = "progress-text"

            progressContainer.appendChild(progressBar)
            progressSection.appendChild(progressContainer)
            progressSection.appendChild(progressText)

            // Создать поля формы
            stories[currentStoryId].forEach((question, index) => {
                const formGroup = document.createElement("div")
                formGroup.className = "form-group"

                const label = document.createElement("label")
                label.textContent = `${index + 1}. ${question}`

                const input = document.createElement("input")
                input.type = "text"
                input.id = `input-${index}`
                input.placeholder = "Введите ответ..."
                input.autocomplete = "off"

                // Добавить обработчик изменения для каждого поля
                input.addEventListener("input", updateProgress)

                formGroup.appendChild(label)
                formGroup.appendChild(input)
                formContainer.appendChild(formGroup)
            })

            // Инициализировать прогресс
            updateProgress()
        }

        // Функцию для обновления прогресса
        function updateProgress() {
            const totalFields = stories[currentStoryId].length
            let filledFields = 0

            // Посчитать заполненные поля
            for (let i = 0; i < totalFields; i++) {
                const input = document.getElementById(`input-${i}`)
                if (input && input.value.trim() !== "") {
                    filledFields++
                }
            }

            // Рассчитать процент заполнения
            const percent = Math.round((filledFields / totalFields) * 100)

            // Обновить прогресс-бар
            const progressBar = document.getElementById("progress-bar")
            const progressText = document.getElementById("progress-text")

            if (progressBar && progressText) {
                progressBar.style.width = `${percent}%`
                progressBar.textContent = `${percent}%`
                progressText.textContent = `Заполнено ${filledFields} из ${totalFields} полей`
                progressText.style.color = ""
            }
        }

        // Показать результат истории
        function showResult() {
            const words = []
            // Собрать все ответы
            for (let i = 0; i < stories[currentStoryId].length; i++) {
                const input = document.getElementById(`input-${i}`)
                const word = input.value.trim() || "___"
                words.push(word)
            }

            // Сгенерировать историю на основе выбранного заголовка
            let story = ""

            switch (currentStoryTitle) {
                case titles[0]:
                    story = `На протяжении всего года ${words[0]} мечтал о своём летнем отпуске. Он планировал отправиться ${words[1]}, чтобы насладиться ${words[4]} ${words[2]} и ${words[5]} ${words[3]}. Наконец, долгожданный отпуск наступил. ${words[0]} собрал свои вещи, включая ${words[6]}, ${words[7]} и несколько ${words[8]}, и отправился ${words[1]}. Первые дни отпуска он провёл ${words[9]}, ${words[10]} и ${words[11]}. Вечером ${words[0]} ${words[12]}, ${words[13]}. В один из дней он решил ${words[14]}. На следующий день произошло ${words[15]}, изменив все его планы. В конце отпуска ${words[0]} был полон впечатлений и воспоминаний о своих приключениях. Он вернулся домой с ${words[16]}, ${words[17]} и множеством ${words[18]}, которые напоминали ему о незабываемых моментах его летнего отпуска.`
                    break
                case titles[1]:
                    story = `${words[0]} давно мечтала посетить музей ${words[1]}, потому что она любила ${words[2]} и ${words[3]}. В день похода в музей ${words[1]}, ${words[0]} надела свой любимый ${words[4]} и отправилась туда с ${words[5]}. Когда они вошли в музей, они ${words[6]}. Они рассмотрели картину «${words[7]} с ${words[8]}». «${words[9]}! Эта картина ${words[10]}», - закричала ${words[0]}. Затем они побывали в ${words[11]} зале, где увидели ${words[12]}. В конце посещения музея, ${words[0]} с ${words[5]} зашли в музейный магазин, где купили себе ${words[13]} на память. Возвращаясь домой, ${words[0]} была очень ${words[14]} и ${words[15]} после этого увлекательного похода.`
                    break
                case titles[2]:
                    story = `Сегодня утром ${words[0]} проснулся с ${words[1]} в животе. Он попытался ${words[2]} таблетку от боли, но не помогло. ${words[0]} решил, что лучше всего будет сходить ${words[3]}. Там его приняла доктор ${words[4]}, которая провела осмотр и сказала: «${words[5]}!». Затем с помощью профессионального медицинского ${words[6]} доктор провела обследование. Результаты показали, что у него было острое воспаление ${words[7]}. Доктор рекомендовала ${words[8]} для лучшего контроля состояния. ${words[0]} поначалу опасался, но понял, что это лучшее решение для его здоровья. Проведя несколько дней ${words[9]} под наблюдением ${words[10]}, он почувствовал себя гораздо лучше. Теперь он знает, ${words[4]} - самый ${words[11]} врач на планете.`
                    break
                case titles[3]:
                    story = `Сегодня в школе №${words[0]} учительница по ${words[1]} ${words[2]} объявила, что на уроке будет ${words[3]}. Все начали ${words[4]}. ${words[5]} сказал: «${words[6]}?». ${words[2]} достала из ящика ${words[7]} и раздала ученикам. ${words[5]} закричал: «${words[8]}!». Прошло несколько минут. ${words[2]} следила за учениками, а затем начала ${words[9]}. В это время ${words[5]} обратился к ${words[10]} и спросил: «${words[11]}?». ${words[2]} заметила это, перестала ${words[9]} и крикнула: «${words[5]}, а ну ${words[12]} сам!». Тогда ${words[5]} ответил: «${words[13]}» и вышел из класса. ${words[2]} поставила ему ${words[14]}, а родители дома дали ему ${words[15]}.`
                    break
                case titles[4]:
                    story = `Сегодня вечером я решил посмотреть новый фильм ужасов «${words[0]} ${words[1]} ${words[2]}», о котором многие говорили. Главную роль исполнил ${words[3]}. Я пригласил друзей и приготовил ${words[4]} ${words[5]}. Когда начался фильм, я захотел ${words[6]}. Вдруг на экране появился ${words[7]}, и я ${words[8]}, а мои друзья ${words[9]}. Мы поставили фильм на паузу, ${words[10]}, а затем продолжили смотреть. Вдруг, на экране снова появлялся ${words[7]}, и я опять ${words[8]}. Когда фильм закончился, друзья сказали: «Было ${words[11]}!» и предложили в следующий раз посмотреть фильм «Проклятье ${words[12]}». Я сказал, что буду посмотрю это фильм, если в главной роли будет ${words[13]}.`
                    break
                case titles[5]:
                    story = `В маленькой мастерской по ремонту телефонов работал мастер по имени ${words[0]}. У него было прозвище «${words[1]}», потому что он был очень ${words[2]}. Однажды в мастерскую заглянул ${words[3]} парень по имени ${words[4]}. У него был ${words[5]} телефон, которому требовался серьёзный ремонт. Мастер ${words[1]} попросил рассказать о проблеме. ${words[4]} рассказал, что его телефон начал ${words[6]} после того, как он уронил его с высоты ${words[7]} метров на ${words[8]}. ${words[0]} внимательно осмотрел телефон и понял, что нужно заменить ${words[9]}. Мастер приступил к работе, а ${words[4]} с интересом наблюдал за процессом и ${words[10]}. Вскоре телефон был полностью восстановлен. Парень обрадовался и крикнул: «${words[11]}!». ${words[4]} спросил, сколько стоит ремонт. Мастер ответил: «${words[12]} рублей». ${words[4]} сказал, что у него нет таких денег и протянул мастеру ${words[13]}. Тогда ${words[0]} выхватил телефон у парня и кинул его ${words[14]}. ${words[4]} сказал: «Вы очень ${words[15]} мастер. Я буду ${words[16]} на вас!».`
                    break
                case titles[6]:
                    story = `${words[0]} решили провести давно запланированный ремонт в своей квартире. Всё началось с поиска ${words[1]}, который смог бы помочь им с ремонтом. После долгих поисков им удалось найти ${words[2]} ${words[1]} по ремонту. Они обговорили все детали, выбрали ${words[3]}, и началась работа. Первые дни ремонта были насыщены звуками ${words[4]} и запахом ${words[5]}. Семья переехала временно из ${words[6]} ${words[7]}, чтобы не мешать работникам ${words[8]}. Каждый день они приезжали на недолгие визиты, чтобы ${words[9]}. Наконец, настал день, когда всё было готово. Семья вернулась в свою квартиру и ${words[10]}. Они были поражены результатом. Всё выглядело ${words[11]} и ${words[12]}. Ремонт создал ${words[13]} обстановку, в которой им хотелось проводить время вместе и ${words[14]}.`
                    break
                case titles[7]:
                    story = `Дорогой Дедушка Мороз, ${words[0]} нос! Я очень хочу, чтобы в этом году ${words[1]} у меня оказался ${words[2]}. Ещё я очень мечтаю о ${words[3]}! В этом году я был очень ${words[4]} и хорошо ${words[5]}. В следующем году я обещаю быть ${words[6]}, стараться ${words[7]}, делиться ${words[8]} с родителями, и, конечно же, каждый день ${words[9]} без напоминания. Надеюсь, ты услышишь мою просьбу. С наступающим Новым Годом! С любовью, ${words[10]} (${words[11]} годиков).`
                    break
                case titles[8]:
                    story = `«Какой сегодня был тяжёлый день ${words[1]}», - сказала ${words[0]}. Она мечтала добраться ${words[2]}, чтобы ${words[3]}. В автобусе она слушала ${words[4]}, но, выходя, не заметила, как выронила ${words[5]} ${words[6]}. Дома девушка обнаружила пропажу и очень ${words[7]}. На следующий день ${words[0]} пошла ${words[8]}, где сидела вчера, и спросила у ${words[9]}, не видел ли он её ${words[6]}. Он улыбнулся и достал из-под ${words[10]} знакомый ${words[5]} ${words[6]}. Оказалось, его нашла ${words[11]} и оставила ${words[12]}. ${words[0]} поблагодарила и купила ${words[13]} в знак благодарности. Теперь она всегда ${words[14]} карманы перед выходом.`
                    break
                case titles[9]:
                    story = `${words[0]} сел в поезд от ${words[1]} до ${words[2]} и с облегчением бросил ${words[3]} на верхнюю полку. За окном уже темнело, а поезд всё наполнялся ${words[4]}. В купе вошёл ${words[5]} с большим ${words[6]} и сел напротив. «Вы не против, если я ${words[7]}?» - спросил незнакомец, доставая ${words[8]}. ${words[0]} кивнул и достал ${words[9]}, но вдруг поезд дёрнулся, и ${words[10]} упал на пол. Незнакомец поднял его и неожиданно ${words[11]}. Спустя время, незнакомец представился ${words[12]}. Они разговорились, и выяснилось, что незнакомец - ${words[13]} ${words[14]}. Уже была поздняя ночь. ${words[0]} заснул. Во сне он увидел ${words[15]} ${words[16]}, поэтому он резко проснулся и крикнул «${words[17]}!». Когда поезд прибыл, ${words[0]} вышел на станции «${words[18]}» и пошёл ${words[19]}.`
                    break
                case titles[10]:
                    story = `Я решил забежать в магазин «${words[0]} ${words[1]}» перед закрытием, но не учёл, что в это время там начинается настоящий ад. В ${words[2]} отделе я заметил последний ${words[3]} ${words[4]}! Но тут же к полке подлетела ${words[5]} с ${words[6]}, нацелившись на тот же ${words[4]}. Мы устроили ${words[7]} битву. Я схватил ${words[8]}, который лежал рядом и кинул в неё. ${words[5]} испугалась и ушла. Победа была за мной, я ликовал и крикнул: «${words[9]}!». Но тут я услышал громкий топот! ${words[5]} бежала на меня, держа в руках ${words[10]} ${words[11]}, крича: «${words[12]}!». Она сшибла меня с ног, я выронил ${words[4]}, мы оба валялись на полу. Тут подошёл третий покупатель поднял ${words[4]} и ушёл. В итоге я и ${words[5]} проиграли. Тут к нам подошёл охранник и спросил: «${words[13]}?». Мы ответили: «Мы ${words[14]}». В общем, нас выгнали из магазина, и мы пошли ${words[15]}.`
                    break
                case titles[11]:
                    story = `У лукоморья ${words[0]} ${words[1]};\n${words[2]} ${words[3]} на нём:\nИ днём и ночью ${words[4]} ${words[5]}\nВсё ходит по ней кругом;\nИдёт направо - ${words[6]} ${words[7]},\nНалево - ${words[8]} ${words[9]}.\nТам чудеса: там ${words[10]} ${words[11]},\n${words[12]} ${words[13]} сидит;\nТам на неведомых дорожках\nСледы невиданных ${words[14]};\n…\nВ темнице там ${words[15]} ${words[16]},\nА ${words[17]} ${words[18]} ей верно служит;\nТам ступа с ${words[19]}\nИдёт, бредёт сама собой,\nТам царь ${words[20]} над ${words[21]} чахнет;\nТам русский дух… там Русью пахнет!\nИ там я был, и ${words[22]} я пил.`
                    break
                case titles[12]:
                    story = `Было ${words[0]} воскресное утро, и я, как обычно, отправился на прогулку ${words[1]} со своим псом по кличке ${words[2]}. Он был ${words[3]}, ${words[4]} и вечно ${words[5]} - казалось, ничто не могло испортить его настроение. Мы шли по ${words[6]} тропинке ${words[7]}, как вдруг ${words[2]} резко остановился, насторожив ${words[8]}. Из кустов донёсся слабый писк - там сидел ${words[9]} щенок, весь дрожащий от холода. ${words[2]} тут же подошёл и аккуратно ${words[10]} его, будто говоря: «${words[11]}». Я завернул малыша в свою ${words[12]} и уже собирался идти ${words[13]}, как заметил на дереве объявление о пропаже этого пёсика. Я позвонил по номеру указанному в объявлении. И вот через час мы сидели ${words[14]} у ${words[15]} женщины, которая ${words[16]} своего любимца, а он восторженно ${words[17]}. Оказалось, щенок выскользнул из ошейника во время их прогулки ${words[18]} дней назад. По дороге домой ${words[2]} гордо нёс в зубах ${words[19]} - подарок от благодарной женщины.`
                    break
                case titles[13]:
                    story = `${words[0]} решил устроить дома настоящую дискотеку 90-х с цветными ${words[1]}, громкой ${words[2]} и даже ${words[3]}, которую одолжил у друга. Первые полчаса всё шло отлично, пока ${words[4]} не начал вибрировать в такт басам, а ${words[5]} не закачалась, как на шторме. Внезапно раздался резкий стук в дверь - на пороге стояла соседка баба ${words[6]} с лицом, как у ${words[7]}, раздавленного катком. «Молодой человек, у меня тут ${words[8]} дребезжит, а ${words[9]} с дивана упал!» - прошипела она. ${words[0]}, не растерявшись, крикнул: «${words[10]}!» - и сунул ей в руки стакан с ${words[11]}. К удивлению всех, через десять минут баба ${words[6]} уже зажигала под песню «${words[12]}». Вдруг свет погас - оказалось, сосед-электрик дядя ${words[13]} "случайно" вырубил пробки, но, услышав «${words[12]}», сам пришёл чинить и остался танцевать. К полуночи на вечеринке было полподъезда, а баба ${words[6]} отбивала у студентов ${words[14]} под техно. Утром дядя ${words[13]} был найден спящим ${words[15]}, а ${words[16]} - баба ${words[6]}.`
                    break
                case titles[14]:
                    story = `В ${words[0]} ${words[1]} на окраине города уже ${words[2]} лет работал компьютерный клуб «${words[3]} ${words[4]}». Сюда приходили школьники, студенты и даже ${words[5]}, чтобы поиграть в «${words[6]}», «${words[7]}» или просто посидеть в интернете. Владелец клуба, дядя ${words[8]}, знал всех посетителей по именам и иногда разрешал ${words[9]} допоздна. Однажды в клуб зашёл новый парень - ${words[10]}, но ${words[11]}. Он сел за дальний компьютер и начал играть в «${words[12]}» так мастерски, что скоро вокруг собралась толпа зрителей. Через неделю он уже обыгрывал всех в клубе, с тех пор у него прозвище «${words[13]}». Но однажды «${words[13]}» проиграл. Его победил ${words[14]} паренёк ${words[15]}, который обычно приходил просто ${words[16]}. Оказалось, ${words[15]} тренировался по ночам. После этого поражения «${words[13]}» исчез, а в клубе появилась легенда о таинственном гении. Через год клуб закрыли - наступила эра домашних компьютеров. Но те, кто там бывал, до сих пор вспоминают запах ${words[16]} ${words[17]}, крики «${words[18]}!» и последний бой, который вошёл в историю.`
                    break
                case titles[15]:
                    story = `Был ${words[0]} ${words[1]} вечер, когда ${words[2]} спешил ${words[3]} после работы. Дождь лил как из ${words[4]}, и видимость на дороге была ${words[5]}. Он уже представлял, как сядет на ${words[6]} с ${words[7]} ${words[8]}, но судьба распорядилась иначе. На скользком повороте ${words[9]} выскочила машина, которая явно не справилась с управлением. ${words[2]} резко нажал на ${words[10]}, попытался увернуться от удара, но его ${words[11]} тоже занесло. Раздался ${words[12]} грохот - машины ${words[13]}. К счастью, никто не пострадал, но его сердце бешено ${words[14]}. Подошла ${words[15]} из второй машины. Они вызвали ${words[16]} и, ${words[17]} от холода и стресса, ждали помощи. Позже ${words[2]} понял: скорость и плохая погода - опасное сочетание. С тех пор он всегда ездил ${words[18]}, помня тот ${words[19]} вечер.`
                    break
                case titles[16]:
                    story = `Пятница, ${words[0]}. Рабочий день окончен. В офисе остались только я и мои коллеги: ${words[1]}, ${words[2]} и ${words[3]}. Внезапно погас свет, и в темноте ${words[4]} ${words[5]}. Мы ${words[6]}. ${words[1]} заметила надпись ${words[7]}: «Найдите код, иначе вы ${words[8]}». Мы переглянулись - кто-то явно решил ${words[9]} нас. Первая подсказка была ${words[10]} у ${words[11]}: «Ищите там, где ${words[12]}». Мы рванули ${words[13]} и нашли там карточку с цифрами. Вторая загадка привела нас ${words[14]}, где в ${words[15]} лежал ключ от ${words[16]}. Нас ждал последний этап - головоломка с ${words[17]} и ${words[18]}. После ${words[19]} часов споров ${words[2]} догадался, что код - это дата основания компании. Дверь щёлкнула, и свет включился. Мы опять ${words[6]}. В коридоре стоял наш ${words[20]} с ${words[21]}. Он сказал: «Поздравляю, ${words[22]}, вы прошли корпоративный квест!». Оказалось, это был сюрприз к юбилею фирмы. ${words[23]}, но ${words[24]}, мы ${words[25]} ели торт и вспоминали, как ${words[3]} чуть не сломал дверь ${words[26]}. Лучший корпоратив в моей жизни!`
                    break
                case titles[17]:
                    story = `Поездка ${words[0]} обернулась ${words[1]} кошмаром, когда ${words[2]} остался в ${words[3]} месте посреди ночи, потому что его машина ${words[4]}. Единственным укрытием оказался ${words[5]} отель с вывеской «№666», хотя на картах его не было. ${words[2]} зашёл внутрь. На ресепшене стоял ${words[6]} с ${words[7]} кожей ${words[8]} и сказал: «У нас как раз освободился номер… последний». Лифт ${words[9]}, будто ${words[10]}, а в коридоре пахло ${words[11]} и чем-то ${words[12]}. В номере ${words[2]} нашёл дневник прошлого постояльца с пометками: «Они не ${words[13]} и «Не смотри в ${words[14]} после полуночи». Часы пробили 12, и ${words[15]} вдруг погас. В темноте послышалось шуршание ${words[16]}, будто ${words[17]} ползло по стене. ${words[2]} зажёг ${words[18]} на телефоне и увидел в зеркале за своей спиной силуэт с слишком ${words[19]} ${words[20]}. Оно шептало: «Ты теперь часть отеля». Утром в отель пришёл новый гость - ${words[21]}, а ${words[6]}, ухмыляясь, повторял: «У нас как раз освободился номер… последний».`
                    break
                case titles[18]:
                    story = `Будильник не сработал, и ${words[0]} проснулся только тогда, когда ${words[1]} уже бил в глаза. В панике он глянул на ${words[2]} - ${words[3]}, а к ${words[4]} надо быть на ${words[5]} совещании! Он вскочил, на ходу натягивая ${words[6]}, и выбежал ${words[7]}, забыв даже ${words[8]}. ${words[9]} его ждал новый сюрприз - проколотое колесо. Пока он пытался ${words[10]} его, он весь запачкался, а одежда покрылись ${words[11]}. Тогда он пошёл на автобус, но тут оказалась задержка из-за ${words[12]} ${words[13]}, и ${words[0]}, стиснув ${words[14]}, вызвал такси. Водитель ${words[15]} решил поговорить по душам и рассказал, что когда-то тоже опаздывал на работу… и потерял из-за этого ${words[16]} миллионный контракт. Эта история не прибавила ${words[17]}. Когда ${words[0]} наконец ворвался в офис, начальник-${words[18]} посмотрел на него и сказал: «${words[19]}, ты опоздал ровно настолько, чтобы пропустить самое интересное - совещание отменили». Коллеги засмеялись, а ${words[0]} просто рухнул на ${words[20]}, понимая, что все его мучения были напрасны.`
                    break
                case titles[19]:
                    story = `Когда я проснулся, первое, что почувствовал, - это ${words[0]} ${words[1]}, падающие мне на ${words[2]}. Я вскочил и увидел в зеркале… лицо своей подруги. В тот же момент раздался звонок: «Привет, ${words[3]}, это я. То есть ты. Мы поменялись ${words[4]}!» - кричал мой собственный ${words[5]} в ${words[6]}. Мы встретились ${words[7]}, пытаясь понять, как ${words[8]}. ${words[9]} (в моём теле) ${words[10]} смотрела, как я (в её теле) ем ${words[11]} руками. «Хоть веди себя ${words[12]}!» - шипела она. Но когда её позвали ${words[13]}, а я не знал их имён, пришлось ${words[14]}. День был ${words[15]}: я едва не сломал ${words[16]} на её каблуках, а она случайно ${words[17]} с моими друзьями. Вечером мы сидели на ${words[18]}, ненавидя всё. «Ты - ${words[19]} девушка», - сказала ${words[9]}. «А ты - ${words[20]} парень», - ответил я. И тут… мы снова оказались в своих телах. Больше мы никогда не ${words[21]} - а вдруг опять поменяемся?`
                    break
                case titles[20]:
                    story = `Утро началось с того, что ${words[0]} пролил ${words[1]} на свежевыглаженную ${words[2]}. Затем он обнаружил, что его ${words[3]} разряжен, а ${words[4]} сломана. Выбежав ${words[5]}, он попал под внезапный ${words[6]} - ${words[7]}, конечно, остался ${words[8]}. В автобусе ${words[9]} нахамила, а потом выяснилось, что ${words[0]} сел не на тот маршрут. На работе его встретил ${words[10]} начальник: «Где ${words[11]}, который должен был быть готов вчера?». ${words[0]} понял, что забыл его ${words[12]}. В обед автомат с ${words[13]} съел его деньги, не выдав ${words[14]}. Коллега пошутил: «Видимо, сегодня не твой день», но ${words[0]} уже не смеялся. Вечером он обнаружил, что ${words[15]} остались в офисе, а дома ждала ещё одна «радость» - прорвало ${words[16]}. ${words[0]} сел на пол, ${words[17]} и сказал: «Ладно, завтра точно будет лучше»`
                    break
                case titles[21]:
                    story = `Однажды утром в детективное агентство «${words[0]} и компания» пришла ${words[1]} посылка без обратного адреса. На коробке было лишь имя: «${words[2]}». Детектив ${words[3]} вскрыла её и обнаружила ${words[4]} дневник, фотографию заброшенного дома с ${words[5]} и ключ с номером «${words[6]}». В дневнике говорилось о пропаже человека в ${words[7]} году, а на обороте фото была надпись: «Истина в доме у ${words[8]} в деревне «${words[9]}» ». ${words[3]} отправилась по адресу, указанному в архивных ${words[10]}, и нашла тот самый дом. Ключ подошёл к ${words[11]} двери. Внутри она обнаружила запертый ${words[12]}, который открыла кодом из дневника. Там лежали ${words[13]}, ${words[14]}, но главное - документы, доказывающие, что ${words[2]} был невиновен в преступлении, в котором его обвинили. ${words[3]} разыскала его родственников и передала им находку. Оказалось, настоящий преступник - скрывался все эти годы под чужим именем. ${words[15]} арестовала его. Посылку отправил старый ${words[16]} семьи, который перед смертью хотел восстановить справедливость. Дело было закрыто, а ${words[3]} получила благодарность от агенства за раскрытое дело.`
                    break
                case titles[22]:
                    story = `На ${words[0]} деревенской улице жила бабушка ${words[1]} - ${words[2]}, но ${words[3]} старушка, которая славилась своими ${words[4]} и… любовью к скорости. Всю жизнь она мечтала о ${words[5]} автомобиле, и однажды её ${words[6]} подарил ей ${words[7]} «БМВ». Соседи ${words[8]}, когда баба ${words[1]} в первый раз выехала на шоссе, ${words[9]} разгоняясь до сотни. «Это же опасно!» - кричали они, но она только ${words[10]}: «В молодости на тракторе гоняла - тут хоть подушки безопасности есть!» Вскоре по деревне поползли слухи: кто-то ночью видел, как бабушка лихо ${words[11]} молодежь на мотоциклах. А однажды она даже помогла поймать ${words[12]} - догнала его на своём «БМВ» и заблокировала ${words[13]}, пока не приехала ${words[14]}. Бабушку ${words[1]} получила прозвище «${words[15]} асфальта», но своими ${words[4]} она продолжала славиться, ведь теперь они разлетались ещё быстрее - она сама развозила их по соседям. И пусть ${words[6]} переживал, что она «слишком ${words[16]}», бабушка только смеялась: «Жизнь-то одна - надо прожить её с ветерком!» А «БМВ» её так и остался самым ${words[17]}, но ${words[18]} членом семьи.`
                    break
                case titles[23]:
                    story = `${words[0]} случайно нашла старый телефон ${words[1]}. Экран был разбит, но устройство работало. Когда она ${words[2]} его, пришло сообщение: «Не возвращайся ${words[3]}. Они тебя ищут.». Девочка ${words[4]} - вокруг никого не было. Решив, что это чья-то шутка, она положила телефон в ${words[5]}. Но вечером, когда она зашла в подъезд, свет мигнул, и в углу ${words[6]} тень. На следующий день ${words[0]} написала подруге о находке. Та ${words[7]}, но уже через час перестала ${words[8]}. Вечером ${words[0]} получила фото: её подруга ${words[9]} сидела с заклеенным ${words[10]} ртом, а надпись гласила: «Ты нарушила правило». Следующее фото было более ${words[11]}. На фото была … ${words[0]}. «Хочешь быть следующей?» - пришло сообщение. ${words[0]} ${words[12]} бросилась домой, но дверь была приоткрыта. В квартире царил ${words[13]}, а на стене красной краской было написано: НИКОМУ НЕ ГОВОРИ. ${words[0]} зашла внутрь и начала вызывать ${words[14]}. Гудки… Гудки… Трубку сняли. «Алло!» - крикнула ${words[0]}. «Тебя предупреждали!» - раздался ответ. ${words[0]} ${words[15]} выбежала из квартиры, но там её уже поджидало нечто… С тех пор её никто не видел. Говорят, её телефон до сих пор иногда звонит...`
                    break
                case titles[24]:
                    story = `1. Шопинг-марафон: Отправься ${words[0]} и купи то, что давно хотел: нового ${words[1]}, дизайнерскую ${words[2]} или пару ${words[3]} ${words[4]}. Добавь к этому ${words[5]} и ${words[6]}. И вот ты уже с пустым кошельком, но с полными сумками.<br>
                            2. Гастрономический тур: Закажи ужин в самом ${words[7]} ресторане города, попробуй блюда, которые никогда не ел: ${words[8]}, ${words[9]}, ${words[10]}. Дополни это хорошим ${words[11]} и ${words[12]}.<br>  
                            3. Моментальное путешествие: Зайди на сайт авиабилетов, выбери первый попавшийся ${words[13]} тур - и улети сегодня же. Бронь ${words[14]}, ужин с видом на ${words[15]} и прогулки по ${words[16]} улочкам съедят всю зарплату, но оставят ${words[17]} на годы.<br>  
                            4. День в SPA: Запишись на ${words[18]}, уход за ${words[19]} и омолаживание ${words[20]}. Выйдешь ${words[21]} человеком - и с ${words[21]} балансом на карте.<br>  
                            5. Азартные развлечения: Сходи в казино или купи ${words[22]} лотерейных билетов. Либо ${words[23]} зарплату, либо ${words[24]} всё за пару часов. Адреналин гарантирован!<br>  
                            6. Благотворительность: Потрать всю сумму на помощь ${words[25]} или ${words[26]}. Можно закупить ${words[27]}, ${words[28]} или просто перевести деньги. Останется приятное послевкусие (но не денег).<br>
                            7. Хобби-разгул: Если ты ${words[29]} - купи ${words[30]}. Если ${words[31]} - ${words[32]}. Если ${words[33]} - ${words[34]}. Вложись в свою страсть без остатка!<br>
                            8. Вечеринка за свой счёт: Сними ${words[35]}, закажи ${words[36]} и ${words[37]}. Пригласи ${words[38]} и устрой праздник, о котором все будут говорить. Утром ты проснёшься без денег, но с кучей воспоминаний (и, возможно, головной болью).<br>
                            9. Стань меценатом на один день: Купи ${words[39]} у уличного художника, оплати выступление начинающей группы ${words[40]}. Можно заказать стихи о себе у ${words[41]} или поддержать местного ремесленника, скупив у него ${words[42]}. Искусство - вечно, а зарплата - нет.<br>
                            10. Устрой день «ДА»: Хочешь прокатиться на ${words[43]} вместо метро? Да! Зайти в каждый магазин по пути домой? Да! Скупить ${words[44]} у кассы? Да! Заказать пиццу с ${words[45]} и ${words[46]}? Конечно, да! Главное правило - ни в чём себе не отказывать. К вечеру кошелёк опустеет, но ты точно поймёшь, насколько приятно (или опасно) жить без запретов.`
                    break
                case titles[25]:
                    story = `В далёкой параллельной Вселенной, где законы ${words[0]} были чуть мягче, а люди немного ${words[1]}, президентом огромной страны был… пушистый чёрно-белый кот по имени Сэр ${words[2]} ${Math.floor(Math.random() * 10) + 1}. Его выбрали не за политическую программу, а потому что он умел ${words[3]} в камеру так, что даже самые ${words[4]} оппоненты начинали мурлыкать в ответ. Сэр ${words[2]} правил ${words[5]}: вместо ${words[6]} он вводил обязательные чаепития с ${words[7]}, вместо налогов - всеобщую раздачу ${words[8]}, а вместо тюрем - комнаты для размышлений с клубками ниток. Его советниками были учёные ${words[9]}, а министром обороны - ${words[10]}, но ${words[11]} ${words[12]}. Однажды инопланетная цивилизация решила захватить Землю, но, увидев, как Сэр ${words[2]} ${words[13]} опрокидывает со стола ${words[14]} и смотрит на них с немым укором, пришельцы ${words[15]}, подарили им технологию приготовления ${words[16]} и улетели. А когда срок его правления подошёл к концу, Сэр ${words[2]} просто лёг ${words[17]} на своём президентском кресле, и все согласились, что лучшего лидера им не найти. Так кот, который правил миром, доказал, что иногда достаточно просто быть мудрым… и немножко пушистым.`
                    break
                case titles[26]:
                    story = `Всё началось с ${words[0]} спора в чате игры - я назвал ${words[1]} соперника ${words[2]}, а он в ответ обозвал меня ${words[3]}. За пару часов перепалка разрослась до ${words[4]} масштабов: мы забросали друг друга ${words[5]}, фейковыми жалобами и даже устроили ${words[6]} в общем клане. Но когда админы пригрозили ${words[7]}, я вдруг осознал, как это ${words[8]}. Набравшись смелости, написал оппоненту: «${words[9]}?». Оказалось, он тоже устал от ${words[10]}. Теперь мы иногда играем в одной команде, а тот конфликт вспоминаем со смехом. Вывод прост: даже за экраном - живые люди.`
                    break
                case titles[27]:
                    story = `В детском саду «${words[0]}» готовились к утреннику, и повар ${words[1]} только что закончила огромный торт с кремовыми ${words[2]}. Но когда она вернулась ${words[3]}, от сладкого шедевра остался лишь пустой поднос. Воспитательница ${words[4]} собрала всех детей в кружок. «Кто украл торт?» - строго спросила она. Малышня ${words[5]}, но никто не признавался. Тогда ${words[4]} решила провести расследование. На полу возле стола она заметила крошки и… следы ${words[6]} лапок. «Это не дети!» - удивилась она. Вдруг из-за шкафа раздался шорох. Все замерли. Оттуда вылез ${words[7]} кот ${words[8]} - главный проказник садика. Его ${words[9]} и усы были в сливочном креме. «Вот кто ${words[10]} торт!» - засмеялись дети. ${words[1]} вздохнула и пообещала испечь новый. А ${words[8]}, довольный, улёгся на солнышке - теперь он был не только вором, но и самым ${words[11]} котом на свете.`
                    break
                case titles[28]:
                    story = `Всё началось с того, что я не влез в ${words[0]} джинсы. Весы показали пугающие цифры (${words[1]} кг), и я понял - пора ${words[2]}. Первым делом я закупился ${words[3]}, ${words[4]} и куриной ${words[5]}, а от ${words[6]} отказался. Первые два дня я гордился собой, но на третий день меня потянуло к ${words[7]}. Ночью я тайком съел полбанки ${words[8]}, а утром мучился угрызениями совести. Тогда я решил пойти в зал, но после пяти минут на беговой дорожке еле ${words[9]}. Тренер посоветовал не ${words[10]} и составить план. Через неделю я сбросил килограмм и обрадовался, но потом ${words[11]} встал. Я ${words[12]}, хотел всё бросить, но друг предложил ${words[13]}. Мы начали тренироваться вместе, и стало легче. Через месяц я скинул ${words[14]} кило (теперь я вешу ${Number(words[1]) - Number(words[14])} кг), но главное - привык к здоровой еде. Правда, иногда позволяю кусочек ${words[15]} - без фанатизма. Теперь я понимаю: диета - это не мучение, а путь к себе. И да, в те джинсы я снова влез!`
                    break
                case titles[29]:
                    story = `Утром в новостях объявили, что к Земле летит ${words[0]} астероид. Ученые говорили, что столкновение неизбежно, и до "часа Х" осталось три дня.<br>День первый. Город охватила ${words[1]}: люди скупали ${words[2]} и ${words[3]}, банки опустели, а на заправках выстроились километровые очереди. Я сидел у окна и смотрел, как сосед пытается запихнуть в машину три ${words[4]} ${words[5]}. "${words[6]}", - подумал я, но всё равно набрал маме. Она ${words[7]} и говорила, что хочет встретить конец вместе. Я пообещал приехать.<br>День второй. В небе появилась ${words[8]} точка - это был астероид. В соцсетях писали, что кто-то уже начал грабить магазины. Я собрал рюкзак с ${words[9]} и поехал к родителям.<br>День третий. Мы сидели ${words[10]} и смотрели, как небо становится всё ярче. Мама держала меня за ${words[11]}, папа достал ${words[12]} вина, которую хранил "на особый случай". И тут… астероид пролетел мимо. Оказалось, его траекторию пересчитали в последний момент. Люди ${words[13]}, плакали, обнимались. А я понял: даже если бы это был конец, самое важное - быть рядом с теми, кого любишь.`
                    break
                default:
                    story = "Неизвестная история"
            }

            // Показать раздел с результатом
            formSection.style.display = "none"
            resultSection.style.display = "block"

            // Установить содержимое результата
            resultTitle.textContent = currentStoryTitle
            // Разделяем историю на части и выделяем введённые слова
            let highlightedStory = story
            words.forEach(word => {
                if (word !== "___") {
                    const regex = new RegExp(escapeRegExp(word), "g")
                    highlightedStory = highlightedStory.replace(regex, `<span class="user-word">${word}</span>`)
                }
            })
            resultText.innerHTML = highlightedStory
        }

        // Вспомогательная функция для экранирования спецсимволов в регулярках
        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, "\\$&")
        }

        // Вернуться к выбору истории
        function goHome() {
            formSection.style.display = "none"
            resultSection.style.display = "none"
        }

        // Обработчики событий
        startBtn.addEventListener("click", startStory)
        resultBtn.addEventListener("click", showResult)
        homeBtn.addEventListener("click", goHome)
        modalClose.addEventListener("click", hideModal)
        modalConfirm.addEventListener("click", hideModal)

        // Закрытие модального окна при клике вне его
        messageModal.addEventListener("click", (e) => {
            if (e.target === messageModal) {
                hideModal()
            }
        })

        // Инициализация приложения
        initDropdown()

        // Обработчик события выпадающего списка
        storySelect.addEventListener("change", () => {
            // Скрываем блок с формой и результатом при изменении выбора
            formSection.style.display = "none"
            resultSection.style.display = "none"
        })

        // Иконки для кнопок
        function addIconsToButtons() {
            const startBtn = document.getElementById("start-btn")
            const resultBtn = document.getElementById("result-btn")
            const homeBtn = document.getElementById("home-btn")
            const modalConfirm = document.getElementById("modal-confirm")

            startBtn.innerHTML = `<i>📖</i> ${startBtn.textContent}`
            resultBtn.innerHTML = `<i>🪄</i> ${resultBtn.textContent}`
            homeBtn.innerHTML = `<i>🏠</i> ${homeBtn.textContent}`
            modalConfirm.innerHTML = `<i>👍</i> ${modalConfirm.textContent}`
        }

        // Темная тема
        function toggleTheme() {
            document.body.style.transition = 'none' // Отключаем анимацию для мгновенного изменения
            const isCurrentlyDark = document.body.classList.contains("dark-theme")

            // Создаем эффект "моргания" при переключении
            document.body.style.opacity = '0.7'
            setTimeout(() => {
                document.body.style.opacity = '1'
                document.body.style.transition = 'opacity 0.3s ease, background-color 0.5s ease, color 0.5s ease'

                document.body.classList.toggle("dark-theme")
                const isDark = document.body.classList.contains("dark-theme")
                localStorage.setItem("dark-theme", isDark)
                document.querySelector(".theme-icon").textContent = isDark ? "🌞" : "🌙"
            }, 100)
        }

        // Проверка сохраненной темы
        if (localStorage.getItem("dark-theme") === "true") {
            document.body.style.opacity = '0'
            document.body.classList.add("dark-theme")
            document.querySelector(".theme-icon").textContent = "🌞"

            // Плавное появление после применения темы
            setTimeout(() => {
                document.body.style.transition = 'opacity 0.5s ease'
                document.body.style.opacity = '1'
            }, 10)
        }

        // Количество историй
        function updateStoriesCount() {
            const countElement = document.getElementById("stories-count")
            const activeStories = titles.filter(title => !title.includes("СКОРО")).length
            countElement.textContent = activeStories
        }

        // Инициализация
        document.getElementById("theme-toggle").addEventListener("click", toggleTheme)
        updateStoriesCount()
        addIconsToButtons()

        resultBtn.addEventListener("click", function () {
            // Проверяем, есть ли запись о созданных историях
            if (!localStorage.getItem('storiesCreated')) {
                // Показываем уведомление
                showFirstStoryCongratulation()
                // Устанавливаем флаг, что хотя бы одна история создана
                localStorage.setItem('storiesCreated', 'true')
            }
            // Остальная логика функции showResult...
            showResult()
        })

        // Функция для показа поздравления
        function showFirstStoryCongratulation() {
            const congrats = document.createElement('div')
            congrats.innerHTML = 'Поздравляем с созданием первой истории!🎉'
            congrats.style.position = 'fixed'
            congrats.style.bottom = '20px'
            congrats.style.left = '20px'
            congrats.style.padding = '15px'
            congrats.style.background = 'linear-gradient(45deg, #6c5ce7, #a29bfe)'
            congrats.style.color = 'white'
            congrats.style.borderRadius = '10px'
            congrats.style.boxShadow = '0 4px 15px rgba(0,0,0,0.2)'
            congrats.style.zIndex = '1000'
            congrats.style.animation = 'fadeIn 0.5s, bounce 2s infinite'

            // Добавляем CSS анимации
            const style = document.createElement('style')
            style.innerHTML = `
        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
    `
            document.head.appendChild(style)

            document.body.appendChild(congrats)

            // Убираем уведомление через 5 секунд
            setTimeout(() => {
                congrats.style.transition = 'opacity 0.5s'
                congrats.style.opacity = '0'
                setTimeout(() => congrats.remove(), 500)
            }, 5000)
        }

        // Функция для обновления состояния кнопки "Избранное"
        function updateFavoriteButton() {
            const favoriteBtn = document.getElementById("favorite-btn")
            const currentTitle = storySelect.value
            const favorites = getFavorites()
            const isFavorite = favorites.includes(currentTitle)

            favoriteBtn.classList.toggle("active", isFavorite)
        }

        // Функция для получения списка избранных историй из localStorage
        function getFavorites() {
            const favorites = localStorage.getItem("favorites")
            return favorites ? JSON.parse(favorites) : []
        }

        // Функция для показа анимации сердца
        function showHeartAnimation(isFavorite) {
            const heart = document.createElement('div')
            heart.className = 'heart-animation'
            heart.innerHTML = '❤️'

            if (isFavorite) {
                heart.classList.add('heartbeat')
            } else {
                heart.classList.add('heartbreak')
                // Добавляем эффект трещины
                setTimeout(() => {
                    heart.innerHTML = '💔'
                    heart.style.fontSize = '80px'
                }, 300)
            }

            document.body.appendChild(heart)

            // Удаляем элемент после завершения анимации
            setTimeout(() => {
                heart.remove()
            }, 1000)
        }

        // Функция для добавления/удаления истории в избранное
        function toggleFavorite() {
            const currentTitle = storySelect.value
            let favorites = getFavorites()
            const wasFavorite = favorites.includes(currentTitle)

            // Показываем соответствующую анимацию
            showHeartAnimation(!wasFavorite)

            if (wasFavorite) {
                favorites = favorites.filter(title => title !== currentTitle)
            } else {
                favorites.push(currentTitle)
            }

            localStorage.setItem("favorites", JSON.stringify(favorites))
            updateFavoriteButton()

            // Полностью перестраиваем выпадающий список
            rebuildStoryDropdown()
            updateStoriesTable()
        }

        // Функция для полного перестроения выпадающего списка
        function rebuildStoryDropdown() {
            const currentValue = storySelect.value
            const favorites = getFavorites()

            // Сохраняем текущее значение
            const scrollPosition = storySelect.scrollTop

            // Очищаем и перестраиваем список
            storySelect.innerHTML = ''

            // Сначала избранные
            titles.forEach(title => {
                if (favorites.includes(title)) {
                    const option = document.createElement("option")
                    option.value = title
                    option.textContent = `❤️${title}❤️`
                    storySelect.appendChild(option)
                }
            })

            // Затем остальные
            titles.forEach(title => {
                if (!favorites.includes(title)) {
                    const option = document.createElement("option")
                    option.value = title
                    option.textContent = title
                    storySelect.appendChild(option)
                }
            })

            // Восстанавливаем значение и позицию прокрутки
            if (titles.includes(currentValue)) {
                storySelect.value = currentValue
            }
            storySelect.scrollTop = scrollPosition

            updateFavoriteButton()
        }

        // Функция для обновления выпадающего списка историй с учетом избранных
        function updateStoriesDropdown() {
            const favorites = getFavorites()
            const options = Array.from(storySelect.options)

            // Сортируем options - избранные сначала
            options.sort((a, b) => {
                const aIsFavorite = favorites.includes(a.value)
                const bIsFavorite = favorites.includes(b.value)
                return bIsFavorite - aIsFavorite
            })

            // Очищаем и добавляем отсортированные варианты
            storySelect.innerHTML = ''
            options.forEach(option => {
                storySelect.appendChild(option)
            })
        }

        // Функция для обновления таблицы историй с учетом избранных
        function updateStoriesTable() {
            const tableBody = document.querySelector("#stories-table tbody")
            tableBody.innerHTML = ''
            fillStoriesTable() // Просто перезаполняем таблицу с новым порядком
        }

        // Инициализация кнопки "Избранное"
        document.getElementById("favorite-btn").addEventListener("click", toggleFavorite)
        storySelect.addEventListener("change", updateFavoriteButton)

        // Обновляем кнопку при загрузке страницы
        document.addEventListener("DOMContentLoaded", () => {
            updateFavoriteButton()
            updateStoriesDropdown()
            updateStoriesTable()
        })

        // Пасхалка
        let clickCount = 0
        const title = document.querySelector("h1")

        title.addEventListener("click", () => {
            clickCount++
            if (clickCount === 5) {
                showEasterEgg()
                clickCount = 0
            }
        })

        function showEasterEgg() {
            // 1. Меняем заголовок
            title.innerHTML = "Генератор смешных историй! <span style='font-size:0.8em'>🦄</span>"
            title.classList.add("easter-egg-title")

            // 2. Добавляем мигающий стиль
            const style = document.createElement("style")
            style.innerHTML = `
        .easter-egg-title {
            animation: rainbow 5s infinite, shake 3s infinite;
        }
        @keyframes rainbow {
            0% { color: #ff0000; }
            20% { color: #ffcc00; }
            40% { color: #33cc33; }
            60% { color: #3399ff; }
            80% { color: #cc66ff; }
            100% { color: #ff0066; }
        }
        @keyframes shake {
            0% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
            100% { transform: rotate(-5deg); }
        }
    `
            document.head.appendChild(style)

            // 3. Показываем сообщение
            setTimeout(() => {
                const msg = document.createElement("div")
                msg.innerHTML = "Поздравляем, ты нашёл секретик!✨"
                msg.style.position = "fixed"
                msg.style.top = "20px"
                msg.style.left = "0"
                msg.style.width = "100%"
                msg.style.padding = "10px"
                msg.style.background = "rgba(108, 92, 231, 0.9)"
                msg.style.color = "white"
                msg.style.textAlign = "center"
                msg.style.zIndex = "1000"
                msg.style.fontWeight = "bold"
                document.body.appendChild(msg)

                // Убираем через 5 секунд
                setTimeout(() => {
                    msg.remove()
                }, 5000)
            }, 300)
        }

    </script>
</body>

</html>